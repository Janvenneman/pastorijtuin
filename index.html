<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>De Pastorijtuin - Reservering</title>
  <style>
    /* Algemeen */
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background-color: #ccffcc; /* lichtgroen */
      text-align: center;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Logo groter */
    .logo {
      display: block;
      margin: 20px auto 10px auto;
      max-width: 500px; /* Grotere logo */
      width: 100%;
      height: auto;
    }

    /* Infotekst: vet, grijs, ander lettertype */
    .infotekst {
      font-family: Georgia, serif;
      font-weight: bold;
      color: #555;
      font-size: 1.1em;
      margin-bottom: 20px;
    }

    /* Hoofdstuk / tekst */
    .hoofdstuk {
      color: #000;
      margin: 20px 0;
      text-align: left;
      line-height: 1.4;
    }

    /* Tabel e.d. */
    table {
      border-collapse: collapse;
      width: 100%;
      margin: 20px 0;
    }
    th, td {
      border: 1px solid #000;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #ddd;
    }

    /* Checkbox / blokknoppen */
    .checkbox-section {
      margin: 20px 0;
    }
    .blok-buttons {
      margin: 20px 0;
    }
    .blok-buttons button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
    }
    .blok-buttons button:disabled {
      background-color: #999;
      cursor: not-allowed;
    }

    /* Tijdslot-sectie */
    .tijdslot-sectie,
    .formulier-sectie,
    .final-message {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #666;
      background-color: #eee;
      display: none; /* verborgen tot we ze tonen via JS */
      text-align: center;
    }

    /* Tijdslot-kleurcodes */
    .tijdslot-button {
      margin: 5px;
      padding: 8px 12px;
      font-size: 1em;
      cursor: pointer;
      color: #fff;
    }
    .tijdslot-button.free {
      background-color: green;
    }
    .tijdslot-button.busy {
      background-color: red;
    }
    #geenKeuzeBtn {
      background-color: orange;
      color: #fff;
    }

    /* Formulier */
    .formulier-label {
      display: block;
      margin: 10px 0 5px;
      font-weight: bold;
      text-align: left;
    }
    .formulier-input {
      width: 80%;
      max-width: 400px;
      padding: 8px;
      margin-bottom: 10px;
    }
    .btn-verzenden {
      background-color: #000;
      color: #fff;
      padding: 10px 20px;
      border: none;
      cursor: pointer;
      font-size: 1em;
      margin-top: 10px;
    }
    .btn-verzenden:disabled {
      background-color: #999;
      cursor: not-allowed;
    }
  </style>
</head>
<body>

  <!-- Logo -->
  <img src="pastorijtuin_logo.jpg" alt="Pastorijtuin Logo" class="logo" />

  <div class="container">
    <!-- Infotekst vlak onder logo -->
    <p class="infotekst">
      Welkom op de website van de Pastorijtuin. Deze website wordt enkel gebruikt
      door de bewoners en eigenaars van onze appartementen voor bepaalde toepassingen.
      U hoeft niet regelmatig te kijken, enkel bij een melding of actie die u doorkrijgt.
    </p>

    <!-- Nieuwe, aangepaste tekst -->
    <div class="hoofdstuk">
      <p>
        <strong>De RME tracht sinds enkele jaren een interessante groepsaankoop</strong> 
        voor het onderhoud verwarmingsinstallatie en afleveren reinigings-& verbrandingsattest.
        Dit jaar hebben we dit <em>opnieuw</em> kunnen bekomen bij
        <strong>Bracq Alain</strong>, na vergelijkingen op de markt.
      </p>
      <p>
        Gelieve onderstaand uw blok en tijdslot te selecteren. Indien 
        er een slot niet meer beschikbaar is, zal u een melding krijgen.
      </p>
    </div>

    <!-- Checkbox + blokkeuzes -->
    <div class="checkbox-section">
      <label>
        <input type="checkbox" id="prijsCheckbox" />
        Ik heb de bovenstaande prijsstelling gelezen en begrepen.
      </label>
    </div>

    <div class="blok-buttons">
      <button id="blok3Btn" disabled>BLOK 3</button>
      <button id="blok3aBtn" disabled>BLOK 3A</button>
      <button id="blok3bBtn" disabled>BLOK 3B</button>
      <button id="blok3cBtn" disabled>BLOK 3C</button>
    </div>

    <!-- Tijdslot-sectie -->
    <div id="tijdslotSectie" class="tijdslot-sectie">
      <h3 id="datumTitel"></h3>
      <div id="tijdslotButtonsContainer"></div>
      <br>
      <button class="tijdslot-button" id="geenKeuzeBtn">
        de datum of uur-keuze passen mij niet
      </button>
    </div>

    <!-- Formulier-sectie -->
    <div id="formulierSectie" class="formulier-sectie">
      <label class="formulier-label" for="naamInput">Naam:</label>
      <input
        type="text"
        id="naamInput"
        class="formulier-input"
        placeholder="Vul je naam in..."
        required
      />

      <label class="formulier-label" for="adresInput">
        Adres appartement (verder aanvullen):
      </label>
      <input
        type="text"
        id="adresInput"
        class="formulier-input"
        placeholder="Blok X, verdiep, nr..."
        required
      />

      <label class="formulier-label" for="contactInput">
        GSM nr of e-mailadres:
      </label>
      <input
        type="text"
        id="contactInput"
        class="formulier-input"
        placeholder="GSM of e-mail..."
        required
      />

      <label class="formulier-label" for="opmerkingenInput">
        Opmerkingen (optioneel):
      </label>
      <textarea
        id="opmerkingenInput"
        class="formulier-input"
        placeholder="Max 100 karakters"
        maxlength="100"
      ></textarea>

      <button id="verzendBtn" class="btn-verzenden" disabled>VERZENDEN</button>
    </div>

    <!-- Eindboodschap -->
    <div id="finalMessage" class="final-message"></div>
  </div> <!-- einde container -->

<script>
  // Supabase configuratie
  const SUPABASE_URL = "https://jnnuhpcsygstrvhrbyna.supabase.co";
  const SUPABASE_KEY = "<SUPABASE_SERVICE_ROLE_KEY>";
  const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

  // DOM-elementen
  const prijsCheckbox = document.getElementById("prijsCheckbox");
  const blok3Btn = document.getElementById("blok3Btn");
  const blok3aBtn = document.getElementById("blok3aBtn");
  const blok3bBtn = document.getElementById("blok3bBtn");
  const blok3cBtn = document.getElementById("blok3cBtn");
  const tijdslotSectie = document.getElementById("tijdslotSectie");
  const tijdslotButtonsContainer = document.getElementById("tijdslotButtonsContainer");
  const datumTitel = document.getElementById("datumTitel");

  let blokData = {};

  // Activeer blokknoppen na het aanvinken van de checkbox
  prijsCheckbox.addEventListener("change", () => {
    const isChecked = prijsCheckbox.checked;
    blok3Btn.disabled = !isChecked;
    blok3aBtn.disabled = !isChecked;
    blok3bBtn.disabled = !isChecked;
    blok3cBtn.disabled = !isChecked;
  });

  // Blok-selectie
  blok3Btn.addEventListener("click", () => showTimeslots("BLOK 3"));
  blok3aBtn.addEventListener("click", () => showTimeslots("BLOK 3A"));
  blok3bBtn.addEventListener("click", () => showTimeslots("BLOK 3B"));
  blok3cBtn.addEventListener("click", () => showTimeslots("BLOK 3C"));

  // Tijdsloten tonen
  function showTimeslots(blok) {
    const blokInfo = blokData[blok];
    tijdslotSectie.style.display = "block";
    datumTitel.textContent = `Datum voor ${blok}: ${blokInfo.date}`;
    tijdslotButtonsContainer.innerHTML = "";

    blokInfo.timeslots.forEach((slot, index) => {
      const button = document.createElement("button");
      button.textContent = slot;
      button.className = blokInfo.selected[index] ? "tijdslot-button busy" : "tijdslot-button free";
      button.disabled = blokInfo.selected[index];
      tijdslotButtonsContainer.appendChild(button);
    });
  }

  // Data laden uit Supabase
  async function loadSlotsFromSupabase() {
    const { data, error } = await supabase.from("time_slots").select("*");
    if (error) console.error("Fout bij Supabase:", error.message);

    blokData = data.reduce((acc, row) => {
      if (!acc[row.blok]) acc[row.blok] = { date: row.date_str, timeslots: [], selected: [] };
      acc[row.blok].timeslots.push(row.slot_label);
      acc[row.blok].selected.push(row.is_selected);
      return acc;
    }, {});
  }

  // Data ophalen bij paginalaad
  window.addEventListener("DOMContentLoaded", loadSlotsFromSupabase);
</script>
</body>
</html>
